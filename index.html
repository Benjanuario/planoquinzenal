<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador de Plano Quinzenal</title>
<style>
body { font-family: "Times New Roman", Times, serif; font-size: 12pt; padding: 20px; background-color: #f9f9f9;}
h1 { text-align:center; color:#333;}
form { max-width:700px; margin:0 auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
label { display:block; margin-top:15px; font-weight:bold;}
select, input { width:100%; padding:8px; margin-top:5px; border-radius:4px; border:1px solid #ccc; font-size:12pt;}
button { margin-top:20px; padding:10px 20px; background:#007BFF; color:#fff; font-size:12pt; border:none; border-radius:6px; cursor:pointer;}
button:hover { background:#0056b3;}
#resultado { margin-top: 30px; background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); display:none; }
pre { white-space: pre-wrap; word-wrap: break-word; }
</style>
</head>
<body>
<h1>Gerador de Plano Quinzenal</h1>
<form id="formPlanoQuinzenal">
  <label>Classe:</label>
  <select id="classe"></select>
  <label>Disciplina:</label>
  <select id="disciplina"></select>
  <label>Trimestre:</label>
  <select id="trimestre">
    <option value="1º Trimestre">1º Trimestre</option>
    <option value="2º Trimestre">2º Trimestre</option>
    <option value="3º Trimestre">3º Trimestre</option>
  </select>
  <label>Semana de:</label>
  <select id="semanaDe"></select>
  <label>Semana até:</label>
  <select id="semanaAte"></select>
  <button type="button" onclick="gerarPlano()">Gerar Plano Quinzenal</button>
</form>

<div id="resultado"><pre id="planoConteudo"></pre></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA9gsPS9IOEm8g37GRTONgqgYSLnS8M7a8",
  authDomain: "profbenjanuario.firebaseapp.com",
  projectId: "profbenjanuario",
  storageBucket: "profbenjanuario.firebasestorage.app",
  messagingSenderId: "782951240161",
  appId: "1:782951240161:web:649298a2e13d04043c42a0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const disciplinasPorClasse = {
  "1ª Classe":["Português","Matemática","Educação Física"],
  "2ª Classe":["Português","Matemática","Educação Física"],
  "3ª Classe":["Português","Matemática","Educação Física"],
  "4ª Classe":["Português","Matemática","Ciências Naturais","Ciências Sociais","Educação Física"],
  "5ª Classe":["Português","Matemática","Ciências Naturais","Ciências Sociais","Educação Visual e Ofícios","Educação Física"],
  "6ª Classe":["Português","Matemática","Ciências Naturais","Ciências Sociais","Educação Visual e Ofícios","Educação Física"],
  "7ª Classe":["Português","Matemática","Biologia","Química","Física","Geografia","História","TIC","Inglês","Educação Visual","Educação Física"],
  "8ª Classe":["Português","Matemática","Biologia","Química","Física","Geografia","História","TIC","Inglês","Educação Visual","Educação Física"],
  "9ª Classe":["Português","Matemática","Biologia","Química","Física","Geografia","História","TIC","Inglês","Educação Visual","Educação Física"],
  "10ª Classe":["Português","Matemática","Biologia","Química","Física","Geografia","História","TIC","Inglês","Francês","Noções de Empreendedorismo","Educação Visual","Educação Física"],
  "11ª Classe":["Português","Matemática","Biologia","Química","Física","Geografia","História","TIC","Inglês","Francês","Filosofia","Noções de Empreendedorismo","EVT","DGD","Educação Física"],
  "12ª Classe":["Português","Matemática","Biologia","Química","Física","Geografia","História","TIC","Inglês","Francês","Filosofia","Noções de Empreendedorismo","EVT","DGD","Educação Física"]
};

function preencherSemanas(selectId) {
  const select = document.getElementById(selectId);
  select.innerHTML = '';
  for (let i = 1; i <= 13; i++) {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = `${i}ª Semana`;
    select.appendChild(opt);
  }
}

function atualizarDisciplinas() {
  const classeSelect = document.getElementById('classe');
  const disciplinaSelect = document.getElementById('disciplina');
  const disciplinas = disciplinasPorClasse[classeSelect.value] || [];
  disciplinaSelect.innerHTML = '';
  disciplinas.forEach(d => {
    const option = document.createElement('option');
    option.value = d;
    option.textContent = d;
    disciplinaSelect.appendChild(option);
  });
}

window.addEventListener('DOMContentLoaded', () => {
  const classeSelect = document.getElementById('classe');
  Object.keys(disciplinasPorClasse).forEach(classe => {
    const option = document.createElement('option');
    option.value = classe;
    option.textContent = classe;
    classeSelect.appendChild(option);
  });
  atualizarDisciplinas();
  preencherSemanas('semanaDe');
  preencherSemanas('semanaAte');
});

async function gerarPlano() {
  const classe = document.getElementById('classe').value;
  const disciplina = document.getElementById('disciplina').value;
  const trimestre = document.getElementById('trimestre').value;
  const semanaDe = parseInt(document.getElementById('semanaDe').value);
  const semanaAte = parseInt(document.getElementById('semanaAte').value);

  if (!classe || !disciplina || !trimestre) {
    alert("Selecione Classe, Disciplina e Trimestre.");
    return;
  }

  if (semanaDe > semanaAte) {
    alert("A semana inicial não pode ser maior que a final.");
    return;
  }

  if (semanaAte - semanaDe > 2) {
    alert("O intervalo não pode exceder 3 semanas (ex: 1 a 3).");
    return;
  }

  try {
    const colRef = collection(db, "programas_ensino", `${disciplina}_${classe}_${trimestre}`, "semanas");
    const querySnapshot = await getDocs(colRef);
    let plano = "";

    querySnapshot.forEach(doc => {
      const data = doc.data();
      if (data.numero >= semanaDe && data.numero <= semanaAte) {
        plano += `Semana ${data.numero}\n`;
        plano += `Unidade Temática: ${data.unidade_tematica || ""}\n`;
        plano += `Objetivos: ${data.objetivo_especifico || ""}\n`;
        plano += `Conteúdos: ${data.conteudo || ""}\n`;
        plano += `Competências: ${data.competencia_basica || ""}\n`;
        plano += `Carga Horária: ${data.carga_horaria || ""}\n\n`;
      }
    });

    const resultadoDiv = document.getElementById("resultado");
    const conteudoEl = document.getElementById("planoConteudo");
    if (plano) {
      conteudoEl.textContent = plano;
    } else {
      conteudoEl.textContent = "Nenhum plano encontrado para o período selecionado.";
    }
    resultadoDiv.style.display = "block";
  } catch (e) {
    console.error(e);
    alert("Erro ao carregar plano: " + e.message);
  }
}
</script>
</body>
</html>
